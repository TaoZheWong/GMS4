var news = [
        {
            "id": "1",
            "type": "system_update",
            "title": "[New] Revamped Material Requisition (MR) Module",
            "posted_by": "Systems",
            "posted_at": "19 August 2016, Fri, 12:00am",
            "desc": "Effective from 19 August 2016, the existing MR module have been revamped for better user experience.",
            "full_desc": ' <p>Effective from 19 August 2016, the existing MR module have been revamped for better user experience.</p> <p>Kindly note that the revamped module may no longer be used in Internet Explorer (IE) browser.However, it can be used in other internet browsers such as <b>Google Chrome</b>, <b>Mozilla Firefox</b> and <b>Safari</b>.</p> <p>Link to download Google Chrome <a href="https://www.google.com/chrome/">https://www.google.com/chrome/</a></p> <p>Should you have any queries, please do not hesitate to contact Kim Yoong: <a href="mailto:keith.wong@leedennox.com">keith.wong@leedennox.com</a>(ext. 668) or Annie Chai : <a href="mailto:annie.chai@leedennox.com">annie.chai@leedennox.com</a> (ext. 667)</p> <p><i>Cheers, Kim Yoong</i></p>'
        },
        {
            "id": "2",
            "type": "system_update",
            "title": "Mergers of LDD & LDL into LWS and NOX & LNX into LNL",
            "posted_by": "Systems",
            "posted_at": "7 April 2016, Fri, 12:00am",
            "desc": "Effective from 1 April 2016, Leeden Distribution Pte Ltd(LDD) and Leeden National Oxygen Limited (Holding & Safety)(LDL) have been merged into Leeden National Oxygen Ltd (Welding Safety)(LWS)....",
            "full_desc": '<p>Effective from 1 April 2016, <strong>Leeden Distribution Pte Ltd(LDD)</strong> and <strong>Leeden National Oxygen Limited (Holding &amp; Safety)(LDL)</strong> have been merged into<strong> Leeden National Oxygen Ltd (Welding Safety)(LWS),</strong> while<strong> Leeden National Oxygen Ltd (Upstream Gases)(NOX)</strong> and <strong>Leeden National Oxygen Ltd (Downstream Gases)(LNX) </strong>have been merged into <strong>Leeden National Oxygen Ltd (Gas Division)(LNL)</strong>.</p> <p>To align with the mergers, GMS users who having the access of <strong>LDD</strong> or <strong>LDL</strong> have been given the same access right in <strong>LWS</strong>. <br> For those users who having the access of <strong>NOX</strong> or <strong>LNX</strong> were given the same access right in <strong>LNL</strong>.</p> <p>However, the access right in LDD, LDL, NOX and LNX will be remained unchange to ensure the accessiblity of the old data. <br> To switch between the companies, please negivate to the upper-right side of GMS screen and choose from the drop-down list. </p> <p>Should you have any queries, please do not hesitate to contact me: <a href="mailto:adam.lee@leedennox.com">adam.lee@leedennox.com</a>(ext. 871)</p> <p><i>Cheers, Adam Lee</i></p>'
        },
        {
            "id": "3",
            "type": "system_update",
            "title": "Change of GMS address",
            "posted_by": "Systems",
            "posted_at": "6 Nov 2015, Fri, 12:00am",
            "desc": "The URL address to access GMS has now been changed !",
            "full_desc": '<p>As part of our continuous effort to provide better user experience to the users, we have recently revamped the backend structure to enhance the performance (speed) of the reports in GMS. </p> <p>As a result of this, the URL address to access GMS has now been changed from: </p> <p><a href="https://gms.leedenlimited.com/GMS"><b>https://gms.leedenlimited.com/GMS</b></a> </p> <p>to</p> <p><a href="https://gms.leedenlimited.com/GMS2"><b>https://gms.leedenlimited.com/GMS<font color="red">2</font></b></a></p> <p>Please update the GMS bookmark(if any) in your browser or shortcut to point to the new address.</p> <p>Should you have any queries, please do not hesitate to contact me: <a href="mailto:adam.lee@leedennox.com">adam.lee@leedennox.com</a>(ext. 871)</p> <p><i>Cheers, Adam Lee</i></p>'
        },
        {
            "id": "4",
            "type": "annoucement",
            "title": "GMS Unavailability",
            "posted_by": "Systems",
            "posted_at": "5 Dec 2014, Fri, 5:50pm",
            "desc": "Please take note of unavailability of GMS system on the date......",
            "full_desc": '<p>GMS system will be unavailable starting at 5pm on Friday, 2nd November 2012 due to installation of new database engine. The system will resume operation the next day on Saturday, 3rd November 2012. We apologize for any inconvenience. </p> '
        },
        {
            "id": "5",
            "type": "system_update",
            "title": "GMS Website",
            "posted_by": "Systems",
            "posted_at": "30 Sep 2014, Tue, 06:21pm",
            "desc": "As part of our continuous effort to provide more secured access to GMS, we have recently made some changes to GMS to enhance its security......",
            "full_desc": '<p>As part of our continuous effort to provide more secured access to GMS, we have recently made some changes to GMS to enhance its security. As a result of this, the website to access GMS has now been changed from <a href="http://gms.leedenlimited.com/GMS"><b>http://gms.leedenlimited.com</b></a> to <a href="https://gms.leedenlimited.com/GMS"><b>http<font color="red">s</font>://gms.leedenlimited.com/GMS</b></a>.</p> <p>See the following: </p> <img src="SSL.bmp" style=" margin-left: 8px; border-width:thin"/> <p> You would also need to configure your browser�s setting as described in the following: <br /> <b><font color="red">1.</font></b>In Internet Explorer, under <b>Tools > Internet Options > Security.</b> <br /> <b><font color="red">2.</font></b>Click <b>Trusted Sites</b>. Click <b>Sites</b>. <br /> <b><font color="red">3.</font></b>In textbox under <b>�Add this website to the zone�</b>, key in https://gms.leedenlimited.com (the textbox should display this address by default), click <b>Add</b> and <b>Close</b> the page. <br /> <b><font color="red">4.</font></b>Click <b>OK</b>. <br /> </p> <p>Do feel free to contact me if you have further queries related to this matter.</p> <p><i>Cheers, Siew Siew</i></p> '

        },
        {
            "id": "6",
            "type": "system_update",
            "title": "Split MR Based on Vendor and Auto-populate Vendor Information",
            "posted_by": "Systems",
            "posted_at": "28 Feb 2014, Fri, 11:20am",
            "desc": "The MR is split according to the Product Team. The splitting logic has been enhanced as described in the following....",
            "full_desc": '<p>Previously, the MR is split according to the Product Team. The splitting logic has been enhanced as described in the following: </p> <ul> <li>For <b>local</b> MR, its still split based on the Product Team. </li> <li>For <b>overseas</b> MR, its now split based on the vendor. For e.g. if the MR consists of products from Product Group H13 and M23, the MR will be split into 2 MRs, as H13 and M23 are provided by different vendors.</li> </ul> <p>Vendor contact information, i.e. Attention To, Tel, Fax, Email, will be inserted automatically based on the vendor information stored in the database. This is to prevent Product Team from having to rekey the contact information whenever a new MR is raised. </p> <p>However, the Product Team is still required to make sure that the vendor information is correct before approval, by clicking the button "<b>Confirm Vendor Information</b>" at the Vendor tab. </p> <p>If the vendor information populated by the system is not up-to-date, you may click "<b>Delete Permanently</b>" to delete such information from the database, and key in the new vendor information at the Vendor tab. When a new MR is raised for this vendor in the future, the latest vendor information will be populated accordingly. </p> <p><i>Cheers, Kim Yoong</i></p>'
        }
],

IsReadNew = function (the_new) {
    if (localStorage) {

        this.read_list = localStorage.getItem("annoucement_read");

        if (this.read_list != null) {

            this.read_list_array = this.read_list.split(",");
            return this.read_list_array.indexOf(the_new.id) < 0 ? false : true;
        } else {
            return false;
        }
    }
},

SetReadNew = function (the_new) {
    if (localStorage) {
        this.read_list = localStorage.getItem("annoucement_read");
        if (this.read_list != null) {

            this.read_list_array = this.read_list.split(",");

            if (this.read_list_array.indexOf(the_new.id) < 0) 
                this.read_list_array.push(the_new.id)

            localStorage.setItem("annoucement_read", this.read_list_array.toString());
        } else {
            localStorage.setItem("annoucement_read", [the_new.id].toString());
        }
    }
},
RenderQuickNews = function (news) {
    this.news = news;
    this.container = $("#notification_list");
    this.container.html("");
    this.container.append($("<li />").addClass("dropdown-header").text("News Feed"));
    this.viewAll = $("<li />").addClass("notification-footer text-center").append($("<a />").attr("href", Path+"/News/Feeds.aspx").text("View more"));

    if (news.length > 0) {
        news.forEach(function (feed, index) {
          
            var li = $("<li />")
                .addClass("notification");
            var info = $("<div />")
                .addClass("notification-info")
                .append($("<h4 />").addClass("notification-title").text(feed.type == "system_update" ? "System Update" : "General Annoucement"))
                .append($("<p />").addClass("notification-desc").text(feed.title))
            var a = $("<a />")
                .attr("href", "javascript:ViewFeed(" + feed.id + ");")
                .append($("<div />").addClass("notification-icon bg-primary").html(feed.type == "system_update" ? "<i class='ti-export'></i>" : "<i class='ti-volume'></i>"))
                .append(info)
                .appendTo(li);

            if(!IsReadNew(feed))
                this.container.append(li);
        });
        
        this.viewAll.appendTo(this.container);
    }
},

AvailableNewFeed = function (news) {
    
}

ViewFeed = function (id) {
    this.selected = _.find(news, function (feed) {
        return feed.id == id;
    });
    this.modal = $("#feed-modal")

    $("#news-feed-title").text(selected.title);
    $("#news-feed-content").html(selected.full_desc);
    $("#news-feed-icon").addClass(selected.type == "system_update" ? "ti-export" : "ti-volume");

    SetReadNew(this.selected);

    this.modal.modal('show');
    RenderNews(news);
    RenderQuickNews(news);
    EmptyQuickNews(news);
},

RenderNews = function(news) {
    this.news = news;
    $("#feedContainer").html("");
    this.news.forEach(function (item, index) {
        $("#feedContainer").append(CreateNew(item));
    })
}

CreateNew = function(the_new) {
    this.the_new = the_new;
    /*
    this.title = $("<h2 />")
        .addClass("feed-title")
        .append($("<a />").attr("href","javascript:;").html(the_new.title))
        .append($("<small/>").addClass("feed-detail ").html("posted by " + the_new.posted_by + ", " + the_new.posted_at));

    this.desc = $("<p />").addClass("feed-desc").html(the_new.desc);
    this.content = $("<div />").addClass("feed-content").append(this.title).append(this.desc);

    this.li = $("<li />");
    this.li
        .addClass("feed-item clearfix")
        .addClass(IsReadNew(the_new) ? "Read" : "Unread")
        .append(content)
        .click(function () {
            ViewFeed(the_new.id);
        });
    return this.li;
    */

    this.time = $("<span />").addClass("email-time").html(the_new.posted_at);
    this.sender = $("<div />").addClass("email-sender").append(this.time).append(the_new.posted_by);
    this.title = $("<div />").addClass("email-title").html(the_new.title);
    this.desc = $("<div />").addClass("email-desc").html(the_new.desc);
    this.a = $("<a />").click(function () {
        ViewFeed(the_new.id);
    }).append(this.sender).append(this.title).append(this.desc);
    this.content = $("<div />").addClass("email-message").append(a);

    this.li = $("<li />");
    this.li
        .addClass(IsReadNew(the_new) ? "" : "unread")
        .append(content)
        .click(function () {
            ViewFeed(the_new.id);
        });
    return this.li;
}

EmptyQuickNews = function (news) {
    this.news = news;
    this.remaingCount = this.news.length;
    this.news.forEach(function (item, index) {
        if(IsReadNew(item))
            this.remaingCount--;
    });

    if (this.remaingCount == 0)
        $("#notification_btn").removeClass("with-label")
    else
        $("#notification_btn").addClass("with-label")
        
}

Annoucement = function () {
    "use strict";
    return {
        init: function (newList) {
            RenderQuickNews(newList);
            EmptyQuickNews(newList);
        },
        renderNews: function (newList) {
            RenderNews(newList);
        }
    }
}();